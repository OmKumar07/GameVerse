name: Keep Server Alive

on:
  schedule:
    # Runs every 30 minutes
    - cron: "*/30 * * * *"
  workflow_dispatch: # Allows manual triggering

jobs:
  ping:
    runs-on: ubuntu-latest

    steps:
      - name: Ping GameVerse Backend
        run: |
          echo "🏓 Pinging GameVerse backend server..."

          # Replace with your actual backend URL
          SERVER_URL="https://gameverse-backend-production.up.railway.app"

          # Ping the keep-alive endpoint
          response=$(curl -s -o /dev/null -w "%{http_code}" "$SERVER_URL/api/keep-alive")

          if [ $response -eq 200 ]; then
            echo "✅ Server is alive! Response code: $response"
          else
            echo "❌ Server ping failed! Response code: $response"
            exit 1
          fi

          # Also ping health endpoint
          health_response=$(curl -s -o /dev/null -w "%{http_code}" "$SERVER_URL/api/health")

          if [ $health_response -eq 200 ]; then
            echo "✅ Health check passed! Response code: $health_response"
          else
            echo "⚠️ Health check failed! Response code: $health_response"
          fi

      - name: Log Ping Result
        run: |
          echo "🏓 Keep-alive ping completed at $(date)"
          echo "📊 This workflow helps prevent server cold starts (runs every 30 minutes)"
